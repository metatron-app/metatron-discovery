package app.metatron.discovery.domain.engine.model;

import org.junit.Test;

import java.io.IOException;

import app.metatron.discovery.common.GlobalObjectMapper;
import app.metatron.discovery.domain.datasource.DataSourceSummary;

public class SegmentMetaDataResponseTest {

  @Test
  public void de_serialize() throws IOException {
    String resultString = "{\"id\":\"merged\",\"intervals\":[\"2011-01-01T00:00:00.000Z/2015-01-01T00:00:00.000Z\"],\"columns\":{\"Category\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":27265,\"cardinality\":3,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"City\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":122628,\"cardinality\":122,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Country\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":16944,\"cardinality\":1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"CustomerName\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":196212,\"cardinality\":211,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"DaystoShipActual\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":25102,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"DaystoShipScheduled\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":21486,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Discount\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":23921,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"OrderID\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":214061,\"cardinality\":252,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"PostalCode\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":134812,\"cardinality\":148,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"ProductName\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":585288,\"cardinality\":408,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Profit\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":41159,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"ProfitRatio\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":41544,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Quantity\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":46118,\"cardinality\":14,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Region\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":31620,\"cardinality\":4,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Sales\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":45121,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"SalesAboveTarget\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":16512,\"cardinality\":1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"SalesForecast\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":46350,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"SalesperCustomer\":{\"type\":\"float\",\"hasMultipleValues\":false,\"serializedSize\":53859,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Segment\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":28446,\"cardinality\":3,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"ShipDate\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":79127,\"cardinality\":36,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"ShipMode\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":30851,\"cardinality\":4,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"ShipStatus\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":29206,\"cardinality\":3,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"State\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":73992,\"cardinality\":37,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"Sub-Category\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":60874,\"cardinality\":17,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"__time\":{\"type\":\"long\",\"hasMultipleValues\":false,\"serializedSize\":22502,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"count\":{\"type\":\"long\",\"hasMultipleValues\":false,\"serializedSize\":14534,\"cardinality\":-1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"latitude\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":141748,\"cardinality\":148,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"longitude\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":146470,\"cardinality\":148,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null},\"orderprofitable\":{\"type\":\"dimension.string\",\"hasMultipleValues\":false,\"serializedSize\":16512,\"cardinality\":1,\"nullCount\":-1,\"minValue\":null,\"maxValue\":null,\"errorMessage\":null}},\"serializedSize\":2334264,\"numRows\":9993,\"ingestedNumRows\":9994,\"lastAccessTime\":-1,\"aggregators\":null,\"queryGranularity\":{\"type\":\"duration\",\"duration\":86400000,\"origin\":\"1970-01-01T00:00:00.000Z\"},\"segmentGranularity\":\"MONTH\",\"rollup\":true}";

    SegmentMetaDataResponse response = GlobalObjectMapper.readValue(resultString, SegmentMetaDataResponse.class);
    System.out.println(response.toString());

    DataSourceSummary dataSourceSummary = new DataSourceSummary(response);
    System.out.println(dataSourceSummary);
    System.out.println(dataSourceSummary.getColumnInfo());
  }
}