<!--
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<!-- contents in  -->
<div class="ddp-type-contents-in">

  <div class="ddp-box-popupcontents2 ddp-box-source-create ddp-box-type">
    <!-- Datasource expiration -->
    <div class="ddp-wrap-edit2 ddp-type" *ngIf="createType === 'DB' && getConnectionType() === 'LINK'">
      <label class="ddp-label-type ddp-bold">{{'msg.storage.th.dsource-expire' | translate}}</label>
      <div class="ddp-ui-option-sub">
        <label class="ddp-ui-label-name">
          {{'msg.storage.th.time-interval' | translate}}
        </label>
        <!-- select box -->
        <div class="ddp-type-selectbox ddp-setting" [class.ddp-selected]="isShowExpirationTimeList"
             (click)="isShowExpirationTimeList = !isShowExpirationTimeList"
             (clickOutside)="isShowExpirationTimeList=false">
          <span class="ddp-txt-selectbox">{{selectedExpirationTime.label}}</span>
          <ul class="ddp-list-selectbox ddp-selectdown">
            <li *ngFor="let expiration of expirationTimeList">
              <a href="javascript:" (click)="onChangeExpirationTime(expiration)">
                {{expiration.label}}
              </a>
            </li>
          </ul>
        </div>
        <!-- //select box -->
      </div>
    </div>
    <!-- //Datasource expiration -->
    <!-- Ingestion settings (DB-ENGINE) -->
    <div class="ddp-wrap-edit2 ddp-type" *ngIf="createType === 'DB' && getConnectionType() === 'ENGINE'">
      <label class="ddp-label-type ddp-bold">{{'msg.storage.th.ingestion-settings' | translate}}</label>
      <!-- edit option -->
      <div class="ddp-ui-option-sub">
        <div class="ddp-ui-edit-option">
          <label class="ddp-label-radio" *ngFor="let type of ingestionTypeList" (change)="onChangeIngestionType(type)">
            <input type="radio" [checked]="type.value === selectedIngestionType.value">
            <i class="ddp-icon-radio"></i>
            <span class="ddp-txt-radio">{{type.label}}</span>
          </label>
        </div>
        <!-- box sub -->
        <div class="ddp-box-sub">
          <!-- sub opton -->
          <div class="ddp-box-sub-option">
            <label class="ddp-label-type">{{'msg.storage.th.scope-ingest' | translate}}</label>
            <div class="ddp-option-in">
              <label class="ddp-label-radio" *ngFor="let scope of ingestionScopeTypeList"
                     (change)="onChangeIngestionScopeType(scope)">
                <input type="radio"
                       [disabled]="scope.value === 'INCREMENTAL' && isUsedCurrentTimestampColumn()"
                       [checked]="selectedIngestionScopeType.value === scope.value">
                <i class="ddp-icon-radio"></i>
                <span class="ddp-txt-radio">{{scope.label}}</span>
              </label>
              <!-- single -->
              <div class="ddp-box-option-input ddp-inline" *ngIf="selectedIngestionType.value === 'single'">
                <input type="text" placeholder="10,000" maxlength="5" input-mask="number" class="ddp-txt-right"
                       [ngModel]="ingestionOnceRow"
                       (ngModelChange)="onCheckMaxRow('ingestionOnceRow', $event)">
                <span class="ddp-txt-input">rows</span>
              </div>
              <!-- single -->
            </div>

          </div>
          <!-- //sub opton -->

          <!-- Batch cycle (batch) -->
          <div class="ddp-box-sub-option" *ngIf="selectedIngestionType.value === 'batch'">
            <label class="ddp-label-type">{{'msg.storage.th.batch-cycle' | translate}}</label>
            <div class="ddp-option-in">
              <!-- cycle -->
              <div class="ddp-ui-cycle ddp-clear">
                <!-- 배치주기 -->
                <div class="ddp-type-selectbox ddp-type-cycle" [class.ddp-selected]="isShowBatchTypeList"
                     (click)="isShowBatchTypeList = !isShowBatchTypeList" (clickOutside)="isShowBatchTypeList=false">
                  <span class="ddp-txt-selectbox">{{selectedBatchType.label}}</span>
                  <ul class="ddp-list-selectbox ddp-selectdown">
                    <li *ngFor="let type of batchTypeList">
                      <a href="javascript:" (click)="onSelectBatchType(type)">{{type.label}}</a>
                    </li>
                  </ul>
                </div>
                <!-- //배치주기 -->
                <!-- 시간 (HOURLY) -->
                <div class="ddp-type-selectbox ddp-type-cycle" [class.ddp-selected]="isShowHourList"
                     *ngIf="selectedBatchType.value === 'HOURLY'"
                     (click)="isShowHourList = !isShowHourList" (clickOutside)="isShowHourList=false">
                  <span class="ddp-txt-selectbox">{{selectedHour}}</span>
                  <ul class="ddp-list-selectbox ddp-selectdown">
                    <li *ngFor="let hour of hourList">
                      <a href="javascript:" (click)="onSelectHour(hour)">{{hour}}</a>
                    </li>
                  </ul>
                </div>
                <!-- //시간 (HOURLY) -->
                <!-- 분 (MINUTELY) -->
                <div class="ddp-type-selectbox ddp-type-cycle" [class.ddp-selected]="isShowMinuteList"
                     *ngIf="selectedBatchType.value === 'MINUTELY'"
                     (click)="isShowMinuteList = !isShowMinuteList" (clickOutside)="isShowMinuteList=false">
                  <span class="ddp-txt-selectbox">{{selectedMinute}}</span>
                  <ul class="ddp-list-selectbox ddp-selectdown">
                    <li *ngFor="let minute of minuteList">
                      <a href="javascript:" (click)="onSelectMinute(minute)">{{minute}}</a>
                    </li>
                  </ul>
                </div>
                <!-- //분 (MINUTELY) -->
                <!-- 요일 (WEEKLY) -->
                <div class="ddp-form-wrapper" *ngIf="selectedBatchType.value === 'WEEKLY'">
                  <!-- selectbox -->
                  <!-- 선택시 ddp-selected 추가 -->
                  <div class="ddp-type-selectbox" [class.ddp-selected]="isShowDateList"
                       (click)="isShowDateList = !isShowDateList" (clickOutside)="isShowDateList=false">
                    <span class="ddp-txt-selectbox">{{'msg.storage.btn.sel.day' | translate}}</span>
                    <div class="ddp-wrap-popup2">
                      <ul class="ddp-list-selectbox2">
                        <li *ngFor="let date of dateList" (click)="onSelectDate(date); $event.preventDefault()">
                          <label class="ddp-label-checkbox">
                            <input type="checkbox" [checked]="date.checked">
                            <i class="ddp-icon-checkbox"></i>
                            <span class="ddp-txt-checkbox">{{date.label}}</span>
                          </label>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <!-- //selectbox -->
                  <component-time [defaultTime]="selectedWeeklyTime"
                                  (changeDate)="selectedWeeklyTime = $event"></component-time>
                </div>
                <!-- //요일 (WEEKLY) -->
                <!-- 시간 (DAILY) -->
                <component-time *ngIf="selectedBatchType.value === 'DAILY'"
                                [defaultTime]="selectedDailyTime"
                                (changeDate)="selectedDailyTime = $event"></component-time>
                <!-- //시간 (DAILY) -->
                <!-- crontab (EXPR) -->
                <ng-container *ngIf="selectedBatchType.value === 'EXPR'">
                  <div class="ddp-input-apply">
                    <input type="text" class="ddp-input-txt" placeholder="{{'msg.storage.ui.crontab.ph' | translate}}"
                           [ngModel]="cronText"
                           (ngModelChange)="cronText = $event; cronValidationResult = null"
                           (keypress)="onKeyPressCronText($event)">
                    <em class="ddp-icon-apply" (click)="cronValidation()"></em>
                  </div>
                  <div class="ddp-txt-error" *ngIf="cronValidationResult === false">
                    <em class="ddp-icon-error-s"></em>{{cronValidationMessage}}
                  </div>
                </ng-container>
                <!-- //crontab (EXPR) -->
              </div>
              <!-- //cycle -->
            </div>
          </div>
          <!-- //Batch cycle (batch) -->
          <!-- Max. query row (batch) -->
          <div class="ddp-box-sub-option" *ngIf="selectedIngestionType.value === 'batch'">
            <label class="ddp-label-type">{{'msg.storage.th.max-query-row' | translate}}</label>
            <div class="ddp-option-in ddp-inline">
              <input type="text" class="ddp-input-typebasic ddp-size-sm ddp-txt-right" placeholder="10,000" maxlength="7" input-mask="number"
                     [(ngModel)]="ingestionPeriodRow">
              <div class="ddp-txt-error" *ngIf="isOverPeriodMaxRow()">
                <em class="ddp-icon-error-s"></em>{{'msg.storage.ui.batch.row.error' | translate}}
              </div>
            </div>
          </div>
          <!-- //Max. query row (batch) -->
        </div>
        <!-- //box sub -->
      </div>
      <!-- //edit option -->
    </div>
    <!-- //Ingestion settings (DB-ENGINE) -->
    <!-- Timestamp settings -->
    <div class="ddp-wrap-edit2 ddp-type">
      <label class="ddp-label-type ddp-bold">{{'msg.storage.th.gran.settings' | translate}}</label>

      <!-- Partition (staging) -->
      <div class="ddp-ui-option-sub" *ngIf="createType === 'STAGING'">
        <label class="ddp-ui-label-name">
          {{'msg.storage.ui.dsource.create.partition.keys' | translate}}
        </label>
        <div class="ddp-ui-edit-option">
          <div class="ddp-radio-set">
            <label class="ddp-label-radio" (change)="onChangePartitionType(partitionTypeList[0])">
              <input type="radio" [checked]="selectedPartitionType.value === partitionTypeList[0].value">
              <i class="ddp-icon-radio"></i>
              <span class="ddp-txt-radio">{{partitionTypeList[0].label}}</span>
            </label>
          </div>
          <div class="ddp-radio-hidden">
            <label class="ddp-label-radio" (change)="onChangePartitionType(partitionTypeList[1])">
              <input type="radio" [checked]="selectedPartitionType.value === partitionTypeList[1].value" [disabled]="partitionKeyList.length === 0">
              <i class="ddp-icon-radio"></i>
              <span class="ddp-txt-radio">{{partitionTypeList[1].label}}</span>
            </label>
            <!-- partition -->
            <div class="ddp-wrap-partition" *ngIf="partitionKeyList.length !== 0">
              <!--<div class="ddp-ui-partition">-->
                <!--<ul class="ddp-list-partition ddp-type">-->
                  <!--<li *ngFor="let partition of partitionKeyList">-->
                    <!--<span class="ddp-ui-label">{{partition.name}}</span>-->
                    <!--<div class="ddp-data">-->
                      <!--<span class="ddp-txt-data">{{partition.value}}</span>-->

                    <!--</div>-->
                  <!--</li>-->
                <!--</ul>-->
              <!--</div>-->
              <div class="ddp-ui-partition">
                <ul class="ddp-list-partition" *ngFor="let keys of partitionKeyList; let i = index">
                  <li *ngFor="let key of keys"
                      [ngClass]="{'ddp-disabled' : selectedPartitionType.value === 'DISABLE' || !isEnabledPartitionInput(keys, key)}">
                    <span class="ddp-ui-label" *ngIf="i === 0">{{key.name}}</span>
                    <input type="text" class="ddp-input-typebasic" [(ngModel)]="key.value">
                  </li>
                </ul>
                <!-- button -->
                <div class="ddp-btn-control" *ngIf="partitionKeyList.length !== 0">
                  <!-- 추가 -->
                  <em class="ddp-icon-control-plus"
                      (click)="addPartitionKeys()"
                      *ngIf="partitionKeyList.length < 20">
                  </em>
                  <!-- //추가 -->
                  <!-- 제거 -->
                  <em class="ddp-icon-control-cut"
                      (click)="deletePartitionKeys()"
                      *ngIf="partitionKeyList.length > 1">
                  </em>
                  <!-- //제거 -->
                </div>
                <!-- //button -->
              </div>
            </div>
            <!-- //partition -->
          </div>
        </div>
      </div>
      <!-- //Partition (staging) -->

      <!-- Data range (staging) -->
      <div class="ddp-ui-option-sub" *ngIf="createType === 'STAGING'">
        <label class="ddp-ui-label-name">
          {{'msg.storage.th.data-range' | translate}}
        </label>
        <div class="ddp-ui-edit-option">
          <div class="ddp-radio-set">
            <label class="ddp-label-radio" (change)="onChangeDataRangeType(dataRangeTypeList[0])">
              <input type="radio" [checked]="selectedDataRangeType.value === dataRangeTypeList[0].value">
              <i class="ddp-icon-radio"></i>
              <span class="ddp-txt-radio">{{dataRangeTypeList[0].label}}</span>
            </label>
          </div>
          <div class="ddp-radio-hidden">
            <label class="ddp-label-radio" (change)="onChangeDataRangeType(dataRangeTypeList[1])">
              <input type="radio" [checked]="selectedDataRangeType.value === dataRangeTypeList[1].value">
              <i class="ddp-icon-radio"></i>
              <span class="ddp-txt-radio">{{dataRangeTypeList[1].label}}</span>
            </label>
            <!-- calen -->
            <component-period
              [isShowButtons]="false"
              [defaultType]="'YEAR'"
              [startDateDefault]="startDateTime"
              [endDateDefault]="endDateTime"
              (changeDate)="onChangeRangeTime($event)"
              [disabled]="selectedDataRangeType.value === 'DISABLE'"
            ></component-period>
            <!-- calen -->
          </div>
        </div>
      </div>
      <!-- //Data range (staging) -->

      <!-- sub -->
      <div class="ddp-ui-option-sub">
        <label class="ddp-ui-label-name">
          {{'msg.storage.th.segment.gran' | translate}}
          <!-- info -->
          <div class="ddp-wrap-hover-info ddp-type">
            <em class="ddp-icon-info3"></em>
            <!-- popup -->
            <div class="ddp-box-layout4">
              <div class="ddp-data-title">
                {{'msg.storage.ui.segment-gran.title' | translate}}
              </div>
              <div class="ddp-data-det">
                {{'msg.storage.ui.segment-gran.description' | translate}}
              </div>
            </div>
            <!-- //popup -->
          </div>
          <!-- //info -->
        </label>
        <div class="ddp-type-selectbox ddp-setting" [class.ddp-selected]="isShowSegmentGranularityList"
             (click)="isShowSegmentGranularityList = !isShowSegmentGranularityList"
             (clickOutside)="isShowSegmentGranularityList=false">
          <span class="ddp-txt-selectbox">{{selectedSegmentGranularity.label}}</span>
          <ul class="ddp-list-selectbox ddp-selectdown">
            <li *ngFor="let granularity of segmentGranularityList">
              <a href="javascript:" (click)="onChangeSegmentGranularity(granularity)">
                {{granularity.label}}
              </a>
            </li>
          </ul>
        </div>
      </div>
      <!-- //sub -->
      <!-- sub -->
      <div class="ddp-ui-option-sub">
        <label class="ddp-ui-label-name">
          {{'msg.storage.th.query.gran' | translate}}
          <!-- info -->
          <div class="ddp-wrap-hover-info ddp-type">
            <em class="ddp-icon-info3"></em>
            <!-- popup -->
            <div class="ddp-box-layout4">
              <div class="ddp-data-title">
                {{'msg.storage.th.query.gran.title' | translate}}
              </div>
              <div class="ddp-data-det">
                {{'msg.storage.th.query.gran.description' | translate}}
              </div>
            </div>
            <!-- //popup -->
          </div>
          <!-- //info -->
        </label>
        <div class="ddp-type-selectbox ddp-setting" [class.ddp-selected]="isShowQueryGranularityList"
             (click)="isShowQueryGranularityList = !isShowQueryGranularityList"
             (clickOutside)="isShowQueryGranularityList=false">
          <span class="ddp-txt-selectbox">{{selectedQueryGranularity.label}}</span>
          <ul class="ddp-list-selectbox ddp-selectdown">
            <li *ngFor="let granularity of queryGranularityList">
              <a href="javascript:" (click)="onChangeQueryGranularity(granularity)">
                {{granularity.label}}
              </a>
            </li>
          </ul>
        </div>
      </div>
      <!-- //sub -->
    </div>
    <!-- //Timestamp settings -->
    <!-- Roll up -->
    <div class="ddp-wrap-edit2 ddp-type">
      <label class="ddp-label-type ddp-info-inline ddp-bold ">
        {{'msg.storage.th.rollup.settings' | translate}}
        <!-- hover info -->
        <div class="ddp-wrap-hover-info ddp-type">
          <em class="ddp-icon-info3"></em>
          <!-- popup -->
          <div class="ddp-box-layout4">
            <div class="ddp-data-title">
              {{'msg.storage.th.rollup.description.title' | translate}}
            </div>
            <div class="ddp-data-det">
              {{'msg.storage.th.rollup.description' | translate}}<br><br>
              {{'msg.storage.th.rollup.description.selection' | translate}}<br>
              - {{'msg.storage.th.rollup.description.true' | translate}}<br>
              - {{'msg.storage.th.rollup.description.false' | translate}}
            </div>
          </div>
          <!-- //popup -->
        </div>
        <!-- //hover info -->
      </label>
      <div class="ddp-ui-option-sub">
        <!-- edit option -->
        <div class="ddp-ui-edit-option">
          <label class="ddp-label-radio" *ngFor="let type of rollUpTypeList" (change)="onChangeRollUpType(type)">
            <input type="radio" [checked]="selectedRollUpType.value === type.value">
            <i class="ddp-icon-radio"></i>
            <span class="ddp-txt-radio">{{type.label}}</span>
          </label>
        </div>
        <!-- //edit option -->
      </div>
    </div>
    <!-- //Roll up -->
    <!-- Advanced setting -->
    <advanced-setting [createType]="createType"
                      [tuningConfig]="tuningConfig"
                      [jobProperties]="jobProperties"></advanced-setting>
    <!-- //Advanced setting -->
  </div>
</div>
<!-- //contents in  -->

